<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Page</title>

    <!-- Import Baloo 2 font -->
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #E0F4F9;
            font-family: 'Baloo 2', cursive; 
            margin: 0;
            padding: 0;
        }

        .big-box {
            width: 90%;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #E0F4F9;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background-image: url('/assets/bg.png');
            background-size: cover;
            background-position: center;
        }

        .question p {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        form {
            max-width: 800px;
            margin: 0 auto;
        }

        button {
            font-family: 'Baloo 2', cursive;
            background-color: #6773FF;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }

        button:hover {
            background-color: #45a049;
        }

        @media only screen and (max-width: 768px) {
            .big-box {
                padding: 15px;
            }

            form {
                max-width: 100%;
                padding: 10px;
            }

            .question {
                font-size: 16px;
            }

            button {
                width: 100%;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>

    <div class="big-box">
        <h2><%= quiz.title %></h2>
        <p>You have <%= attemptsLeft %> out of <%= maxAttempts %> attempts remaining.</p>

        <!-- Timer display -->
        <div id="timer-display" data-timer="<%= quiz.timer %>" data-start-time="<%= quizStartTime %>">
            Time Remaining: <span id="timer">Loading...</span>
        </div>

        <!-- Notification message when time runs out -->
        <div id="time-up-message" style="display: none; color: red; font-weight: bold; margin-top: 10px;">
            Time's up! Submitting your quiz automatically.
        </div>

        <!-- Form for submitting quiz answers -->
        <form id="quizForm" action="/admin/quiz/submit/<%= quiz._id %>" method="POST" onsubmit="clearLocalStorage()">
            <input type="hidden" name="roomId" value="<%= quiz.roomId %>">

            <% quiz.questions.forEach((question, qIndex) => { %>
                <div class="question">
                    <p>Question <%= qIndex + 1 %>: <%= question.questionText %></p>

                    <% if (question.type === 'multiple-choice') { %>
                        <% question.choices.forEach((choice) => { %>
                            <label>
                                <input type="radio" name="answers[<%= qIndex %>]" value="<%= choice.text %>">
                                <%= choice.text %>
                            </label><br>
                        <% }); %>
                    <% } else if (question.type === 'fill-in-the-blank') { %>
                        <label>
                            <input type="text" name="answers[<%= qIndex %>]" placeholder="Your answer">
                        </label><br>
                    <% } %>
                </div>
            <% }); %>

            <input type="hidden" name="userId" value="<%= currentUserId %>">
            <button type="submit">Submit Quiz</button>
        </form>
    </div>

    <script src="/js/start.js"></script>

    <script>
        function clearLocalStorage() {
            const quizId = "<%= quiz._id %>";
            localStorage.removeItem(`quizStartTime_${quizId}`);
            localStorage.removeItem(`quizRemainingTime_${quizId}`);
            localStorage.removeItem(`quizProgress_${quizId}`);
        }
    </script>

</body>
</html>
